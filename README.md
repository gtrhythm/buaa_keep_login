# buaa_keep_login

# 功能简介

基于某个命令行下登录buaa网关改写的保持登录python脚本。通过简单粗暴的ping大型网站的方式判断是否与公网保持连接，如果与公网无连接，则重新登陆网关。

其实除了ping大网站之外，访问网关获取连接状态是更优雅的判断网关是否处于登录状态的方法。但这种方法存在一个问题，当开启了clash的全局代理，会导致对网关的访问也被转发到代理服务器上，导致无法查询在线状态。在这种情况下，不优雅的ping方法反而更有效。

代码中设置了时间间隔，并设置了多个可以ping的网站，只有在所有网站都ping不到的时候，才会重新发起连接，避免频繁ping操作与网关连接等操作产生不良影响。

# 针对clash开启全局代理时无法访问网关进行重连的处理

开启clash全局代理会导致断网也无法访问网关，此时会进入到只有【关闭代理才能连接网关->连接网关才能关闭代理】的怪圈，因此代码中通过clash的RESTful API来对clash的代理模式进行操作，当该功能开启时，检测到网络连接中断重连网络时，会先将clash切换到DIRECT直连模式，再连接网关。该功能默认关闭，需要在代码中手动开启。

开启方式：

将

if_close_clash_proxy=False

改为

if_close_clash_proxy=True

并修改port与secret为电脑中clash内的值。

默认情况下secret信息与port信息在 C:\Users\[YOUR_USERNAME]\.config\clash\config.yaml中，可自行复制，当然也可自行修改。

使用该功能请务必将clash的Random Controller Port关闭。该选项位于clash的设置->general->Random Controller Port

# 推荐使用方式

配置好python环境之后，将运行该脚本的命令保存为bat文件，并参考：

https://blog.csdn.net/u011765923/article/details/90748945

中的方法将该bat文件设置为登录前自动运行，也可将远程控制软件（如向日葵、ToDesk等）通过同样的方式设置成登录前自动运行。

如果采用的是wifi则将该wifi设置为自动连接，也可以查询一下优先连接指定wifi的方法，保证与校园网的连接状态。

部分电脑BIOS支持通电自动开机，意外关机之后也可自动开机。

做好上述设置之后，理论上除非遇到电脑完全死机且不会自动关机的情况外，均可保证能保持校内电脑随时维持与外网的连接（即使开了代理也能自动关掉代理并重新连接网关），最大程度上保证不与校内电脑失联。

# 可能存在的问题

在我个人电脑上测试的过程中，ping同一个网站次数过多会请求超时，但此时依然可以访问该网站。目前尚不清楚是网站自身的访问限制，还是我电脑运行环境的问题。欢迎知道原因的大佬提出意见。

如果电脑中有需要持续通过代理访问的程序运行（比如正在挂着一个通过代理下载的大型数据集），那么如果程序对网络连接状态出现误判而发起重连，关闭代理进而导致任务出错。请知晓该风险，或对该种情况做出预案。

尚未经过长期严格测试，对稳定性要求较高的用户推荐先针对自己的使用场景进行测试并评估是否满足需求。


